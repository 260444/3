# API 接口文档

## 基本信息

- **基础URL**: `http://localhost:8080/api/v1`
- **认证方式**: JWT Token
- **数据格式**: JSON
- **字符编码**: UTF-8

## 通用响应格式

### 成功响应

```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... }
}
```

### 错误响应

```json
{
  "success": false,
  "message": "错误信息",
  "error": "错误信息"
}
```

### 业务错误响应

```json
{
  "success": false,
  "message": "业务错误描述",
  "error": "业务错误描述",
  "code": 40001
}
```

### 列表响应

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "list": [ ... ],
    "total": 100,
    "page": 1,
    "page_size": 10
  }
}
```

## 认证说明

除公开接口外，所有接口都需要在请求头中携带 JWT Token：

```
Authorization: Bearer <token>
```

---

## 模块化接口文档

此API文档已按功能模块分离，具体接口详情请参阅以下文档：

- [接口概览](./api/接口概览.md) - 所有接口的快速查阅和分类
- [认证接口文档](./api/auth-api.md) - 用户登录、退出登录等认证相关接口
- [用户管理接口文档](./api/user-api.md) - 用户CRUD操作、密码修改等相关接口
- [角色管理接口文档](./api/role-api.md) - 角色CRUD操作等相关接口
- [菜单管理接口文档](./api/menu-api.md) - 菜单CRUD操作、菜单树等相关接口
- [操作日志接口文档](./api/operation-log-api.md) - 操作日志查询、删除等相关接口
- [权限管理接口文档](./api/permission-api.md) - 权限资源CRUD操作等相关接口
- [角色菜单关联接口文档](./api/role-menu-api.md) - 角色菜单权限分配等相关接口

---

## HTTP 状态码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（Token无效或过期） |
| 403 | 禁止访问（无权限） |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 业务错误码说明

| 错误码 | 说明 |
|--------|------|
| 40001 | 参数错误 |
| 40002 | 数据验证失败 |
| 40101 | 未授权访问 |
| 40301 | 权限不足 |
| 40401 | 资源不存在 |
| 50001 | 服务器内部错误 |
| 50002 | 数据库操作失败 |

---

## 常见业务错误说明

| 错误信息 | 说明 |
|----------|------|
| 用户名已存在 | 注册时用户名重复 |
| 邮箱已存在 | 注册时邮箱重复 |
| 用户名或密码错误 | 登录失败 |
| Token无效或已过期 | 认证失败 |
| 权限不足 | 无权限访问 |
| 资源不存在 | 记录不存在 |
| 数据验证失败 | 参数验证失败 |
| 旧密码错误 | 修改密码时旧密码不正确 |
| 角色不存在 | 指定的角色不存在 |
| 菜单不存在 | 指定的菜单不存在 |
| 策略已存在 | Casbin策略已经存在 |
| 策略不存在 | Casbin策略不存在 |

---

## 注意事项

1. **认证**: 除公开接口外，所有接口都需要在请求头中携带有效的 JWT Token
2. **分页**: 列表接口支持分页，默认每页10条，最大100条
3. **软删除**: 用户、角色、菜单支持软删除，删除后不会物理删除数据
4. **时间格式**: 所有时间字段使用 ISO 8601 格式（如：`2026-01-18T10:00:00Z`）
5. **密码安全**: 密码使用 bcrypt 加密存储，传输时建议使用 HTTPS
6. **权限控制**: 系统基于 RBAC 模型进行权限控制，通过角色分配权限
7. **操作日志**: 系统自动记录用户操作，包括请求和响应信息

---

## 测试建议

推荐使用以下工具进行 API 测试：

- **Postman**: 功能强大的 API 测试工具
- **Insomnia**: 轻量级 API 测试工具
- **curl**: 命令行工具
- **HTTPie**: 友好的命令行 HTTP 客户端

### Postman 测试示例

1. 导入接口集合
2. 设置环境变量（如 `base_url`, `token`）
3. 在 Pre-request Script 中自动设置 Token：
```javascript
// 如果有 token，自动添加到请求头
if (pm.environment.get("token")) {
    pm.request.headers.add({
        key: "Authorization",
        value: "Bearer " + pm.environment.get("token")
    });
}
```

---

## 更新日志

### v1.0.0 (2026-01-18)

- 初始版本发布
- 实现用户管理、角色管理、菜单管理、操作日志功能
- 支持 JWT 认证和 RBAC 权限控制
- 提供完整的 RESTful API 接口
- 新增权限管理接口（菜单权限分配、Casbin 策略管理）
- 新增权限资源管理接口（权限的CRUD操作）