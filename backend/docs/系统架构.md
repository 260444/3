# 系统架构

## 1. 整体架构

```
                    +------------------+
                    |   前端 (Vue 3)   |
                    +------------------+
                              |
                              | HTTP/HTTPS
                              |
                    +------------------+
                    |   Nginx (反向代理)  |
                    +------------------+
                              |
                              | API请求
                              |
          +-------------------+-------------------+
          |                                       |
    +----------+                           +-------------+
    | 后端 (Go) |                           | 数据库 (MySQL) |
    |          |                           |             |
    | - API层   |                           | - 用户表     |
    | - 服务层  |<------------------------->| - 角色表     |
    | - 数据层  |                           | - 菜单表     |
    | - 工具层  |                           | - 操作日志表  |
    +----------+                           +-------------+
          |                                       |
          |                                       |
    +----------+                           +-------------+
    | 缓存 (Redis)|                          | 权限管理 (Casbin) |
    |           |                           |              |
    | - 会话存储 |                           | - 策略存储    |
    | - 验证码  |                           | - 模型定义    |
    +----------+                           +-------------+
```

## 2. 后端架构

### 2.1 分层架构

```
+-----------------------------------------------+
|                    API层                       |
|  +-------------+  +-------------+  +---------+ |
|  | Handler层   |  | Middleware  |  | Router  | |
|  | (HTTP处理)   |  | (中间件)     |  | (路由)   | |
|  +-------------+  +-------------+  +---------+ |
+-----------------------------------------------+
+-----------------------------------------------+
|                   服务层                       |
|  +-------------+  +-------------+  +---------+ |
|  | UserService |  | RoleService |  | ...     | |
|  | (用户服务)   |  | (角色服务)   |  |         | |
|  +-------------+  +-------------+  +---------+ |
+-----------------------------------------------+
+-----------------------------------------------+
|                  数据访问层                     |
|  +-------------+  +-------------+  +---------+ |
|  | UserRepo    |  | RoleRepo    |  | ...     | |
|  | (用户仓库)   |  | (角色仓库)   |  |         | |
|  +-------------+  +-------------+  +---------+ |
+-----------------------------------------------+
+-----------------------------------------------+
|                   模型层                       |
|  +-------------+  +-------------+  +---------+ |
|  | User模型     |  | Role模型     |  | ...    | |
|  | (用户结构体)  |  | (角色结构体)  |  |        | |
|  +-------------+  +-------------+  +---------+ |
+-----------------------------------------------+
```

### 2.2 技术栈关系

```
+------------------+    +------------------+
|   Go 1.24.0      |    |   Gin框架        |
|   (运行时)        |    |   (Web框架)      |
+--------+---------+    +--------+---------+
         |                         |
         |                         |
         v                         v
+--------+---------+    +--------+---------+
|   GORM         |    |   MySQL        |
|   (ORM)        |    |   (数据库)      |
+--------+---------+    +--------+---------+
         |                         |
         |                         |
         v                         v
+--------+---------+    +--------+---------+
|   Redis        |    |   Casbin       |
|   (缓存)        |    |   (权限管理)    |
+--------+---------+    +--------+---------+
         |                         |
         |                         |
         v                         v
+--------+---------+    +--------+---------+
|   Zap          |    |   Viper        |
|   (日志)        |    |   (配置管理)    |
+------------------+    +------------------+
```

## 3. 前端架构

### 3.1 组件架构

```
+------------------+
|    App.vue       |
|   (根组件)        |
+------------------+
         |
         v
+------------------+
|  Layout.vue      |
|  (布局组件)       |
+------------------+
    |         |
    v         v
+--------+  +--------+
| 侧边栏  |  | 主内容  |
|        |  |        |
+--------+  +--------+
              |
              v
       +-------------+
       |  路由视图    |
       |  (RouterView)|
       +-------------+
              |
              v
       +-------------+
       |  页面组件    |
       |  (Views)    |
       +-------------+
```

### 3.2 状态管理

```
+------------------+
|   Pinia Store    |
|  (全局状态)       |
+------------------+
         |
         v
+------------------+
|  组件A  |  组件B  |
|        |        |
+------------------+
```

## 4. 数据流向

### 4.1 用户请求流程

```
1. 用户访问前端页面
   ↓
2. 前端Vue应用加载
   ↓
3. 用户执行操作（如点击按钮）
   ↓
4. 前端调用API接口
   ↓
5. Nginx反向代理到后端
   ↓
6. Gin路由处理请求
   ↓
7. 中间件验证（JWT、权限）
   ↓
8. Handler调用Service
   ↓
9. Service调用Repository
   ↓
10. Repository操作数据库
   ↓
11. 返回结果给Repository
   ↓
12. Repository返回给Service
   ↓
13. Service返回给Handler
   ↓
14. Handler返回HTTP响应
   ↓
15. Nginx返回给前端
   ↓
16. 前端更新UI
```

### 4.2 认证授权流程

```
+------------------+    +------------------+
|    用户登录       |    |   JWT认证       |
|                  |    |                 |
| 1. 输入用户名密码 | -> | 2. 生成JWT token |
|                  |    |                 |
+------------------+    +------------------+
                              |
                              v
                    +------------------+
                    |   权限验证        |
                    |                 |
                    | 3. 验证token    |
                    | 4. Casbin权限控制 |
                    |                 |
                    +------------------+
```

## 5. 部署架构

```
+-----------------------------------------------+
|                   服务器                        |
|                                               |
|  +-------------+  +-------------+  +---------+ |
|  | 前端静态文件   |  | Go后端应用    |  | MySQL   | |
|  | (Nginx)     |  | (Gin)       |  | (数据库)  | |
|  +-------------+  +-------------+  +---------+ |
|         |                |                |     |
|         |                |                |     |
|         v                v                v     |
|  +-------------+  +-------------+  +---------+ |
|  |  HTTPS请求   |  | API请求      |  | 数据存储  | |
|  | (静态资源)   |  | (动态数据)   |  | (持久化) | |
|  +-------------+  +-------------+  +---------+ |
|                                               |
|  +-------------+  +-------------+  +---------+ |
|  | Redis缓存    |  | 日志文件     |  | 监控     | |
|  | (会话/验证码) |  | (Zap)       |  | (可选)   | |
|  +-------------+  +-------------+  +---------+ |
+-----------------------------------------------+
```

## 6. 安全架构

```
+------------------+    +------------------+
|   前端安全        |    |   后端安全        |
|                 |    |                 |
| - 输入验证       |    | - 输入验证       |
| - XSS防护       |    | - SQL注入防护     |
| - CSRF防护      |    | - 认证授权       |
| - HTTPS传输     |    | - 数据加密       |
+------------------+    +------------------+
         |                         |
         |                         |
         v                         v
+------------------+    +------------------+
|   传输安全        |    |   存储安全        |
|                 |    |                 |
| - TLS/SSL       |    | - 密码加密       |
| - JWT token     |    | - 数据库权限     |
| - API限流       |    | - 备份加密       |
+------------------+    +------------------+
```