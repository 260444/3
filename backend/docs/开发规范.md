# 开发规范文档

## 1. Go语言编码规范

### 1.1 命名规范
- 包名：使用小写字母，简洁明了，如 `config`, `model`, `service`
- 结构体名：使用驼峰命名，首字母大写（导出）或小写（包内使用）
- 接口名：通常以 `er` 结尾，如 `UserService`
- 函数名：导出函数首字母大写，私有函数首字母小写
- 变量名：使用驼峰命名，首字母小写

### 1.2 代码格式
- 使用 `go fmt` 自动格式化代码
- 每行代码长度不超过120个字符
- 使用 `gofmt -s` 简化代码

### 1.3 注释规范
```go
// Package service provides business logic for the application
package service

// UserService handles user-related business logic
type UserService struct {
    UserRepo *repository.UserRepository
    RoleRepo *repository.RoleRepository
}

// GetUserByID retrieves a user by ID
// Returns the user and an error if not found
func (s *UserService) GetUserByID(id uint) (*model.User, error) {
    // implementation
}
```

### 1.4 错误处理
- 错误信息应清晰明了
- 使用 `errors.New()` 或 `fmt.Errorf()` 创建错误
- 统一错误处理格式

## 2. 项目结构规范

### 2.1 目录结构
```
backend/
├── api/                # API层
│   ├── handler/        # HTTP处理器
│   ├── middleware/     # 中间件
│   └── router/         # 路由定义
├── config/             # 配置管理
├── internal/           # 内部包，不可被外部引用
│   ├── model/          # 数据模型
│   ├── repository/     # 数据访问层
│   └── service/        # 业务逻辑层
├── pkg/                # 可被外部引用的公共包
│   ├── cache/          # 缓存相关
│   ├── casbin/         # 权限管理
│   ├── database/       # 数据库相关
│   ├── logger/         # 日志相关
│   ├── redis/          # Redis相关
│   └── utils/          # 工具函数
├── main.go             # 应用入口
└── go.mod              # 依赖管理
```

### 2.2 分层架构
- **Handler层**: 处理HTTP请求和响应
- **Service层**: 业务逻辑处理
- **Repository层**: 数据访问操作
- **Model层**: 数据结构定义
- **中间件层**: 请求处理前后的中间件

## 3. 数据库设计规范

### 3.1 命名规范
- 表名：使用复数形式，如 `users`, `roles`, `menus`
- 字段名：使用小写蛇形命名，如 `user_name`, `created_at`
- 外键：使用 `表名_id` 格式，如 `role_id`, `parent_id`

### 3.2 字段类型
- 主键：`uint` 类型，使用 `gorm:"primaryKey"`
- 时间戳：`time.Time` 类型，GORM会自动处理
- 软删除：使用 `gorm.DeletedAt` 类型

### 3.3 索引和约束
- 为经常查询的字段添加索引
- 为唯一字段添加唯一约束
- 使用 `gorm:"not null"` 标记非空字段

## 4. API设计规范

### 4.1 RESTful API设计
- 使用名词复数形式：`/users`, `/roles`
- 使用HTTP动词表示操作：GET、POST、PUT、DELETE
- 使用状态码表示结果：200、400、401、404、500

### 4.2 响应格式
```json
{
  "message": "操作成功",
  "data": {
    "id": 1,
    "name": "example"
  }
}
```

### 4.3 错误响应
```json
{
  "error": "错误信息"
}
```

## 5. 前端编码规范

### 5.1 Vue 3 + TypeScript
- 使用 Composition API
- 使用 TypeScript 定义接口和类型
- 组件名称使用 PascalCase
- Prop 名称使用 camelCase

### 5.2 目录结构
```
frontend/
├── public/             # 静态资源
├── src/
│   ├── api/            # API 请求
│   ├── assets/         # 静态资源
│   ├── components/     # 可复用组件
│   ├── views/          # 页面组件
│   ├── router/         # 路由配置
│   ├── stores/         # 状态管理
│   ├── utils/          # 工具函数
│   ├── types/          # TypeScript 类型定义
│   ├── styles/         # 全局样式
│   └── main.ts         # 入口文件
├── package.json
└── vite.config.ts      # 构建配置
```

### 5.3 组件开发规范
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 使用 Composition API
import { ref, computed, onMounted } from 'vue'

// 定义类型
interface User {
  id: number
  name: string
}

// 定义响应式数据
const user = ref<User | null>(null)

// 定义计算属性
const displayName = computed(() => user.value?.name || '')
</script>

<style scoped>
/* 组件样式 */
</style>
```

## 6. Git工作流

### 6.1 分支管理
- `main`: 主分支，用于生产环境
- `develop`: 开发分支，用于集成
- `feature/*`: 功能分支，如 `feature/user-management`
- `bugfix/*`: 修复分支，如 `bugfix/login-issue`
- `release/*`: 发布分支，如 `release/v1.0.0`

### 6.2 提交信息规范
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 代码重构
- test: 测试相关
- chore: 构建过程或辅助工具的变动

示例：
```
feat(user): 添加用户注册功能

- 实现用户注册接口
- 添加密码加密逻辑
- 完善错误处理机制
```

## 7. 环境配置

### 7.1 配置管理
- 开发环境：`config/config.dev.yaml`
- 测试环境：`config/config.test.yaml`
- 生产环境：`config/config.prod.yaml`

### 7.2 环境变量
- 数据库连接信息
- Redis连接信息
- JWT密钥
- 第三方API密钥

## 8. 测试规范

### 8.1 单元测试
- 测试覆盖率目标：不低于80%
- 为关键业务逻辑编写测试
- 使用Go内置测试框架

### 8.2 API测试
- 使用Postman或类似的工具进行API测试
- 编写自动化API测试

## 9. 安全规范

### 9.1 输入验证
- 对所有用户输入进行验证
- 防止SQL注入
- 防止XSS攻击

### 9.2 认证和授权
- 使用JWT进行身份认证
- 实现细粒度权限控制
- 定期更新密码策略

### 9.3 数据安全
- 敏感数据加密存储
- 使用HTTPS传输
- 实施访问日志记录

## 10. 性能优化

### 10.1 数据库优化
- 合理使用索引
- 避免N+1查询问题
- 使用连接池

### 10.2 缓存策略
- 使用Redis缓存热点数据
- 设置合理的过期时间
- 实现缓存穿透防护

### 10.3 前端优化
- 使用懒加载
- 实现组件缓存
- 优化图片资源

## 11. 日志规范

### 11.1 日志级别
- DEBUG: 调试信息
- INFO: 一般信息
- WARN: 警告信息
- ERROR: 错误信息
- FATAL: 致命错误

### 11.2 日志格式
使用Zap日志库，输出JSON格式日志
```json
{
  "level": "info",
  "time": "2023-01-01T12:00:00Z",
  "msg": "User logged in",
  "user_id": 123,
  "ip": "192.168.1.1"
}
```

## 12. 部署规范

### 12.1 生产环境要求
- 使用Docker容器化部署
- 实现健康检查
- 配置监控和告警

### 12.2 滚动更新
- 实现零停机部署
- 支持版本回滚
- 配置备份和恢复机制

## 13. 文档规范

### 13.1 代码文档
- 为导出的函数和类型添加注释
- 维护API文档
- 编写使用说明

### 13.2 项目文档
- README.md: 项目介绍和快速开始
- API文档: 接口说明
- 部署文档: 部署说明
- 开发规范: 编码规范