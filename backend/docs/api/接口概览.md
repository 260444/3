# API接口概览

## 基础信息

- **基础URL**: `http://localhost:8080/api/v1`
- **认证方式**: JWT Token
- **数据格式**: JSON
- **字符编码**: UTF-8

## 接口分类

### 🔐 认证相关接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/login` | POST | 用户登录 | ❌ 不需要 |
| `/logout` | POST | 用户退出登录 | ✅ 需要 |
| `/captcha` | GET | 获取验证码 | ❌ 不需要 |

### 👤 用户管理接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/users` | POST | 创建用户 | ✅ 需要 |
| `/users` | GET | 获取用户列表 | ✅ 需要 |
| `/users/:id` | GET | 获取用户详情 | ✅ 需要 |
| `/users/:id` | PUT | 更新用户信息 | ✅ 需要 |
| `/users/:id` | DELETE | 删除用户 | ✅ 需要 |
| `/users/:id/status` | PUT | 更新用户状态 | ✅ 需要 |
| `/users/change-password` | PUT | 修改密码 | ✅ 需要 |
| `/users/:id/reset-password` | PUT | 重置密码 | ✅ 需要 |
| `/users/profile` | GET | 获取当前用户信息 | ✅ 需要 |
| `/users-roles/:username` | POST | 为用户分配角色 | ✅ 需要 |
| `/users-roles/:username` | DELETE | 移除用户角色 | ✅ 需要 |
| `/users-roles/:username` | GET | 获取用户角色列表 | ✅ 需要 |

### 👥 角色管理接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/roles` | POST | 创建角色 | ✅ 需要 |
| `/roles` | GET | 获取角色列表 | ✅ 需要 |
| `/roles/:id` | GET | 获取角色详情 | ✅ 需要 |
| `/roles/:id` | PUT | 更新角色信息 | ✅ 需要 |
| `/roles/:id` | DELETE | 删除角色 | ✅ 需要 |

### 📋 菜单管理接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/menus` | POST | 创建菜单 | ✅ 需要 |
| `/menus` | GET | 获取当前用户菜单 | ✅ 需要 |
| `/menus/all` | GET | 获取所有菜单 | ✅ 需要 |
| `/menus/:id` | PUT | 更新菜单信息 | ✅ 需要 |
| `/menus/:id` | DELETE | 删除菜单 | ✅ 需要 |

### 🔐 权限管理接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/permissions` | POST | 创建权限资源 | ✅ 需要 |
| `/permissions` | GET | 获取权限资源列表 | ✅ 需要 |
| `/permissions/all` | GET | 获取所有权限资源 | ✅ 需要 |
| `/permissions/:id` | GET | 获取权限资源详情 | ✅ 需要 |
| `/permissions/:id` | PUT | 更新权限资源 | ✅ 需要 |
| `/permissions/:id/status` | PUT | 更新权限状态 | ✅ 需要 |
| `/permissions/:id` | DELETE | 删除权限资源 | ✅ 需要 |

### 🔑 角色菜单关联接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/roles/:id/menus` | POST | 为角色分配菜单权限 | ✅ 需要 |
| `/roles/:id/menus` | GET | 获取角色菜单权限 | ✅ 需要 |
| `/roles/:id/menus` | DELETE | 移除角色菜单权限 | ✅ 需要 |

### ⚖️ 权限策略管理接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/roles/:id/policies` | POST | 为角色添加Casbin策略 | ✅ 需要 |
| `/roles/:id/policies` | DELETE | 移除角色Casbin策略 | ✅ 需要 |
| `/roles/:id/policies` | GET | 获取角色Casbin策略 | ✅ 需要 |

### 📝 操作日志接口

| 接口地址 | 方法 | 描述 | 认证要求 |
|---------|------|------|----------|
| `/operation-logs` | GET | 获取操作日志列表 | ✅ 需要 |
| `/operation-logs/:id` | DELETE | 删除操作日志 | ✅ 需要 |

## 权限控制说明

系统基于RBAC（基于角色的访问控制）模型进行权限管理：

1. **用户-角色关联**: 一个用户可以拥有多个角色
2. **角色-菜单关联**: 角色可以被分配多个菜单权限
3. **角色-策略关联**: 角色可以被分配Casbin权限策略
4. **Casbin权限控制**: 基于路径和HTTP方法的细粒度权限控制

## 认证流程

1. 用户通过 `/login` 接口进行登录
2. 系统验证用户名和密码
3. 验证成功后返回JWT Token
4. 客户端在后续请求中通过 `Authorization: Bearer <token>` 头部携带Token
5. 服务端验证Token有效性并进行权限检查

## 响应格式规范

### 成功响应
```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... }
}
```

### 错误响应
```json
{
  "success": false,
  "message": "错误描述",
  "error": "错误描述"
}
```

### 业务错误响应
```json
{
  "success": false,
  "message": "业务错误描述",
  "error": "业务错误描述",
  "code": 40001
}
```

### 分页列表响应
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "page_size": 10
  }
}
```

## HTTP状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（Token无效或过期） |
| 403 | 禁止访问（无权限） |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 业务错误码

| 错误码 | 说明 |
|--------|------|
| 40001 | 参数错误 |
| 40002 | 数据验证失败 |
| 40101 | 未授权访问 |
| 40301 | 权限不足 |
| 40401 | 资源不存在 |
| 50001 | 服务器内部错误 |
| 50002 | 数据库操作失败 |

## 注意事项

1. **认证要求**: 除明确标注为"不需要认证"的接口外，所有接口都需要携带有效的JWT Token
2. **分页支持**: 列表接口默认支持分页，`page`默认为1，`page_size`默认为10，最大100
3. **软删除**: 用户、角色、菜单等资源支持软删除
4. **时间格式**: 所有时间字段使用ISO 8601格式（如：`2026-01-18T10:00:00Z`）
5. **安全性**: 密码使用bcrypt加密存储，建议使用HTTPS传输
6. **日志记录**: 系统自动记录用户操作日志
7. **权限继承**: 用户权限来自其拥有的所有角色权限的并集

## 相关文档

- [认证接口文档](./auth-api.md)
- [用户管理接口文档](./user-api.md)
- [角色管理接口文档](./role-api.md)
- [菜单管理接口文档](./menu-api.md)
- [权限管理接口文档](./permission-api.md)
- [角色菜单关联接口文档](./role-menu-api.md)
- [操作日志接口文档](./operation-log-api.md)